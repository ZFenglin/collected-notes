<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"使用体验","c":[{"t":"heading","d":2,"p":{"lines":[2,3]},"v":"打包分析","c":[{"t":"heading","d":3,"p":{"lines":[4,5]},"v":"speed-measure-webpack-plugin","c":[{"t":"fence","d":4,"v":"<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i speed-measure-webpack-plugin -D\n</code></pre>\n"},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//webpack.config.js</span>\n<span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">SpeedMeasurePlugin</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"speed-measure-webpack-plugin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> smp <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SpeedMeasurePlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...webpack配置</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 包裹webpack配置</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> smp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">wrap</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[25,26]},"v":"webpack-bundle-analyzer","c":[{"t":"fence","d":4,"v":"<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> webpack-bundle-analyzer -D\n</code></pre>\n"},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">BundleAnalyzerPlugin</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span>'webpack<span class=\"token operator\">-</span>bundle<span class=\"token operator\">-</span>\n        analyzer '<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">BundleAnalyzerPlugin</span></span><span class=\"token punctuation\">;</span>\n        module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>baseWebpackConfig<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//....</span>\n            <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token comment\">//...</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">BundleAnalyzerPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[47,48]},"v":"自动删除打包文件","c":[{"t":"fence","d":3,"v":"<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev clean-webpack-plugin\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[55,56]},"v":"Html自动生成并引入JS","c":[{"t":"fence","d":3,"v":"<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev html-webpack-plugin\n</code></pre>\n"},{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">htmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My App\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app.html\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/index.html\"</span>\n            <span class=\"token comment\">// inject: true | 'head' | 'body' | false  // 将资源放置到哪里</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"t":"fence","d":3,"v":"<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>&lt;%= htmlWebpackPlugin.options.title %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[84,85]},"v":"自动刷新","c":[{"t":"heading","d":3,"p":{"lines":[86,87]},"v":"文件监听","c":[{"t":"heading","d":4,"p":{"lines":[88,89]},"v":"开启方式","c":[{"t":"list_item","d":6,"p":{"lines":[90,91],"index":1},"v":"1. webpack.config.js中设置watch: true"},{"t":"list_item","d":6,"p":{"lines":[91,92],"index":2},"v":"2. 启动命令带上 --watch"}]},{"t":"heading","d":4,"p":{"lines":[93,94]},"v":"watchOptions","c":[{"t":"fence","d":5,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token literal-property property\">watchOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 监听模式选项</span>\n    <span class=\"token comment\">// 不监听的文件或文件夹，支持正则匹配，默认为空</span>\n    <span class=\"token literal-property property\">ignored</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">//监听到变化发生后，等300ms再执行动作，截流，防止文件更新太快导致重新编译频率太快，默认为300ms，</span>\n    <span class=\"token literal-property property\">aggregateTimeout</span><span class=\"token operator\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 不停地询问系统指定的文件有没有发生变化，默认每秒询问1000次</span>\n    <span class=\"token literal-property property\">poll</span><span class=\"token operator\">:</span> <span class=\"token number\">1000</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</code></pre>\n"},{"t":"heading","d":5,"p":{"lines":[106,107]},"v":"优化方式","c":[{"t":"list_item","d":7,"p":{"lines":[108,109],"index":1},"v":"1. watchOptions.poll值越小越好，降低检查的频率"},{"t":"list_item","d":7,"p":{"lines":[109,110],"index":2},"v":"2. watchOptions.aggregateTimeout值越大越好，降低重构建的频率"},{"t":"list_item","d":7,"p":{"lines":[110,111],"index":3},"v":"3. ignored过滤不需要监听文件"}]}]},{"t":"heading","d":4,"p":{"lines":[112,113]},"v":"工作原理","c":[{"t":"list_item","d":6,"p":{"lines":[114,115],"index":1},"v":"1. 定时获取文件的最后编辑时间，发现编辑时间不一致则认为不一致了"},{"t":"list_item","d":6,"p":{"lines":[115,116],"index":2},"v":"2. 当文件变化了也不会立即告诉监听者，而是先缓存，收集一段时间一次性通知"}]}]},{"t":"heading","d":3,"p":{"lines":[117,118]},"v":"自动刷新浏览器","c":[{"t":"heading","d":4,"p":{"lines":[119,120]},"v":"实现方式","c":[{"t":"list_item","d":6,"p":{"lines":[121,122],"index":1},"v":"1. 浏览器扩展提供接口"},{"t":"list_item","d":6,"p":{"lines":[122,123],"index":2},"v":"2. 开发的网页注入代理客户端代码"},{"t":"list_item","d":6,"p":{"lines":[123,124],"index":3},"v":"3. 将网页放入一个iframe中"},{"t":"list_item","d":6,"p":{"lines":[124,125],"index":4},"v":"4. DevServer支持，注入则是默认方式"}]},{"t":"heading","d":4,"p":{"lines":[126,127]},"v":"自动刷新浏览器优化性能","c":[{"t":"ordered_list","d":5,"p":{"lines":[130,133],"start":1},"v":"","c":[{"t":"list_item","d":6,"p":{"lines":[130,131],"index":1},"v":"1. 关闭inline方式：devServer.inline配置，默认采用注入方式，关闭则使用iframe方式"},{"t":"list_item","d":6,"p":{"lines":[131,132],"index":2},"v":"2. 手动注入代理客户端代码"}]},{"t":"fence","d":5,"v":"<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://localhost:8080/webpack-dev-server.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n"}]}]}]},{"t":"heading","d":2,"p":{"lines":[137,138]},"v":"热替换","c":[{"t":"ordered_list","d":3,"p":{"lines":[140,143],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[140,141],"index":1},"v":"1. 不刷新整个网页的情况下做到实时渲染"},{"t":"list_item","d":4,"p":{"lines":[141,142],"index":2},"v":"2. 不要在生产环境使用热替换"}]},{"t":"heading","d":3,"p":{"lines":[143,144]},"v":"热替换优势","c":[{"t":"list_item","d":5,"p":{"lines":[145,146],"index":1},"v":"1. 实时预览反应更快"},{"t":"list_item","d":5,"p":{"lines":[146,147],"index":2},"v":"2. 能保持当前页面的运行状态"}]},{"t":"heading","d":3,"p":{"lines":[148,149]},"v":"热替换启动","c":[{"t":"list_item","d":5,"p":{"lines":[150,151],"index":1},"v":"1. 在启动时带上参数 --hot"},{"t":"list_item","d":5,"p":{"lines":[151,152],"index":2},"v":"2. devServer配置上设置为hot: true"}]},{"t":"heading","d":3,"p":{"lines":[153,154]},"v":"热替换原理","c":[{"t":"ordered_list","d":4,"p":{"lines":[155,158],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[155,156],"index":1},"v":"1. 向要开发的网页中注入一个代理客户端连接DevServer和网页"},{"t":"list_item","d":5,"p":{"lines":[156,157],"index":2},"v":"2. 利用独特的模块替换机制处理文件更新"}]},{"t":"heading","d":4,"p":{"lines":[160,161]},"v":"步骤1","c":[{"t":"list_item","d":6,"p":{"lines":[162,163],"index":1},"v":"1. webpack处于watch模式"},{"t":"list_item","d":6,"p":{"lines":[163,164],"index":2},"v":"2. 监听文件变化并重新打包，打包后的代码的JavaScript对象保存在内存中"}]},{"t":"heading","d":4,"p":{"lines":[165,166]},"v":"步骤2","c":[{"t":"list_item","d":6,"p":{"lines":[167,168],"index":1},"v":"1. webpack-dev-middleware调用webpack暴露的API对代码进行监控"},{"t":"list_item","d":6,"p":{"lines":[168,169],"index":2},"v":"2. webpack-dev-middleware通知webpack将代码打包到内存中"}]},{"t":"heading","d":4,"p":{"lines":[170,171]},"v":"步骤3","c":[{"t":"list_item","d":6,"p":{"lines":[173,174],"index":1},"v":"1. devServer.watchContentBase为true时，server监听配置文件夹中静态文件变化"},{"t":"list_item","d":6,"p":{"lines":[174,175],"index":2},"v":"2. 通知浏览器进行live-reload（此处时浏览器刷新）"}]},{"t":"heading","d":4,"p":{"lines":[176,177]},"v":"步骤4","c":[{"t":"list_item","d":6,"p":{"lines":[178,179],"index":1},"v":"1. webpack-dev-server通过sockjs在浏览器和服务端之间建立websocket长连接"},{"t":"list_item","d":6,"p":{"lines":[179,180],"index":2},"v":"2. webpack将编译各个阶段状态通知浏览器"},{"t":"list_item","d":6,"p":{"lines":[180,181],"index":3},"v":"3. 浏览器根据消息进行操作，如文件的hash值来进行后续热替换"}]},{"t":"heading","d":4,"p":{"lines":[182,183]},"v":"步骤5-6","c":[{"t":"list_item","d":6,"p":{"lines":[184,185],"index":1},"v":"1. webpack/hot/dev-server根据webpack-dev-server/client传来的信息进行处理"},{"t":"list_item","d":6,"p":{"lines":[185,186],"index":2},"v":"2. 决定使用浏览器更新还是热更新，浏览器更新则直接到步骤11，后续就不再执行"}]},{"t":"heading","d":4,"p":{"lines":[187,188]},"v":"步骤7-9","c":[{"t":"list_item","d":6,"p":{"lines":[189,190],"index":1},"v":"1. HotModuleReplacement.runtime 是客户端 HMR 的中枢"},{"t":"list_item","d":6,"p":{"lines":[190,191],"index":2},"v":"2. 将传递的hash值发送给JsonpMainTemplate.runtime"},{"t":"list_item","d":6,"p":{"lines":[191,192],"index":3},"v":"3. JsonpMainTemplate.runtime向服务端发送Ajax请求，服务端返回json，包含了所需更新模块的hash值"},{"t":"list_item","d":6,"p":{"lines":[192,193],"index":4},"v":"4. JsonpMainTemplate.runtime再次通过jsonp向服务端请求最新代码"}]},{"t":"heading","d":4,"p":{"lines":[194,195]},"v":"步骤10","c":[{"t":"list_item","d":6,"p":{"lines":[196,197],"index":1},"v":"1. HotModulePlugin对新旧模块进行比对，决定是否更新模块和依赖关系"}]},{"t":"heading","d":4,"p":{"lines":[198,199]},"v":"失败处理","c":[{"t":"list_item","d":6,"p":{"lines":[200,201],"index":1},"v":"1. HMR失败后，回退到 live reload 操作"},{"t":"list_item","d":6,"p":{"lines":[201,202],"index":2},"v":"2. 通知浏览器获取最新打包代码"}]}]}]}]})</script>
</body>
</html>
