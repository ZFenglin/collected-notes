<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"Component处理","c":[{"t":"heading","d":2,"p":{"lines":[4,5]},"v":"RouterLink","c":[{"t":"ordered_list","d":3,"p":{"lines":[6,13],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[6,7],"index":1},"v":"1. 相关属性声明和处理"},{"t":"list_item","d":4,"p":{"lines":[7,8],"index":2},"v":"2. 点击触发事件on创建和设置"},{"t":"list_item","d":4,"p":{"lines":[8,9],"index":3},"v":"3. data声明"},{"t":"list_item","d":4,"p":{"lines":[9,10],"index":4},"v":"4. scopedSlot处理"},{"t":"list_item","d":4,"p":{"lines":[10,11],"index":5},"v":"5. 标签增加对应属性和on事件"},{"t":"list_item","d":4,"p":{"lines":[11,12],"index":6},"v":"6. 返回处理好的渲染函数"}]},{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'RouterLink'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">to</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> toTypes<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 其它属性</span>\n        <span class=\"token comment\">//  ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">h</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 相关属性声明和处理</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token comment\">// 点击触发事件on创建和设置</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handler</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">guardEvent</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// 调用路由实例的replace或push</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">replace</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    router<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replace</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> noop<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                    router<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> noop<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> on <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">click</span><span class=\"token operator\">:</span> guardEvent\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">event</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">event</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                on<span class=\"token punctuation\">[</span>e<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> handler\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            on<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">event</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> handler\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// data声明</span>\n        <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">class</span><span class=\"token operator\">:</span> classes\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// scopedSlot处理</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token comment\">// 标签增加对应属性</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tag</span> <span class=\"token operator\">===</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// a标签data属性处理和on事件添加</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 其它标签data处理和on事件添加</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 返回处理好的渲染函数</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tag</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">$slots</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[68,69]},"v":"RouterView","c":[{"t":"ordered_list","d":3,"p":{"lines":[70,77],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[70,71],"index":1},"v":"1. 设置当前标签为routerView"},{"t":"list_item","d":4,"p":{"lines":[71,72],"index":2},"v":"2. 不断向上访问找到当前的RouterView的层级depth"},{"t":"list_item","d":4,"p":{"lines":[72,73],"index":3},"v":"3. 找到对应的当前RouterView对应的记录matched，并获取component"},{"t":"list_item","d":4,"p":{"lines":[73,74],"index":4},"v":"4. 不存在matched或component，则渲染空标签"},{"t":"list_item","d":4,"p":{"lines":[74,75],"index":5},"v":"5. 缓存组件"},{"t":"list_item","d":4,"p":{"lines":[75,76],"index":6},"v":"6. 返回处理好的渲染函数"}]},{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'RouterView'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">functional</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">String</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword module\">default</span><span class=\"token operator\">:</span> <span class=\"token string\">'default'</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        props<span class=\"token punctuation\">,</span>\n        children<span class=\"token punctuation\">,</span>\n        parent<span class=\"token punctuation\">,</span>\n        data\n    <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 设置当前标签为routerView</span>\n        data<span class=\"token punctuation\">.</span><span class=\"token property-access\">routerView</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token comment\">// 相关属性声明</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token comment\">// 不断向上访问找到当前的RouterView的层级depth</span>\n        <span class=\"token keyword\">let</span> depth <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">let</span> inactive <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">_routerRoot</span> <span class=\"token operator\">!==</span> parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> vnodeData <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">$vnode</span> <span class=\"token operator\">?</span> parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">$vnode</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>vnodeData<span class=\"token punctuation\">.</span><span class=\"token property-access\">routerView</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                depth<span class=\"token operator\">++</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>vnodeData<span class=\"token punctuation\">.</span><span class=\"token property-access\">keepAlive</span> <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">_directInactive</span> <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">_inactive</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                inactive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token punctuation\">}</span>\n            parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">$parent</span>\n        <span class=\"token punctuation\">}</span>\n        data<span class=\"token punctuation\">.</span><span class=\"token property-access\">routerViewDepth</span> <span class=\"token operator\">=</span> depth\n        <span class=\"token comment\">// inactive处理</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>inactive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 找到对应的当前RouterView对应的记录matched，并获取component</span>\n        <span class=\"token keyword\">const</span> matched <span class=\"token operator\">=</span> route<span class=\"token punctuation\">.</span><span class=\"token property-access\">matched</span><span class=\"token punctuation\">[</span>depth<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> matched <span class=\"token operator\">&amp;&amp;</span> matched<span class=\"token punctuation\">.</span><span class=\"token property-access\">components</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span>\n        <span class=\"token comment\">// 不存在matched或component，则渲染空标签</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>matched <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>component<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            cache<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 缓存组件</span>\n        cache<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            component\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 其它处理</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token comment\">// 返回处理好的渲染函数</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> children<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]})</script>
</body>
</html>
