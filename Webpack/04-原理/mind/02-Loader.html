<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"<a href=\"https://www.teqng.com/2021/08/11/%E5%A4%9A%E5%9B%BE%E8%AF%A6%E8%A7%A3%EF%BC%8C%E4%B8%80%E6%AC%A1%E6%80%A7%E6%90%9E%E6%87%82webpack-loader/\">Loader</a>","c":[{"t":"heading","d":2,"p":{"lines":[2,3]},"v":"Loader概念","c":[{"t":"heading","d":3,"p":{"lines":[6,7]},"v":"Loader作用","c":[{"t":"list_item","d":5,"p":{"lines":[8,9],"index":1},"v":"1. 将源文件经过转化输出新结果"},{"t":"list_item","d":5,"p":{"lines":[9,10],"index":2},"v":"2. 一个文件同时还可以经过多个loader一起处理"}]}]},{"t":"heading","d":2,"p":{"lines":[11,12]},"v":"Loader分类","c":[{"t":"heading","d":3,"p":{"lines":[13,14]},"v":"Normal Loader","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token function\">fuction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">source<span class=\"token punctuation\">,</span> inputSourceMap<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"t":"heading","d":4,"p":{"lines":[21,22]},"v":"三个参数","c":[{"t":"list_item","d":6,"p":{"lines":[23,24],"index":1},"v":"1. source：源文件内容"},{"t":"list_item","d":6,"p":{"lines":[24,25],"index":2},"v":"2. inputSourceMap：使用的SourceMap数据"},{"t":"list_item","d":6,"p":{"lines":[25,26],"index":3},"v":"3. data：数据，可以为任何内容"}]},{"t":"heading","d":4,"p":{"lines":[27,28]},"v":"分类","c":[{"t":"ordered_list","d":5,"p":{"lines":[29,34],"start":1},"v":"","c":[{"t":"list_item","d":6,"p":{"lines":[29,30],"index":1},"v":"1. pre 前置"},{"t":"list_item","d":6,"p":{"lines":[30,31],"index":2},"v":"2. post 后置"},{"t":"list_item","d":6,"p":{"lines":[31,32],"index":3},"v":"3. normal 普通"},{"t":"list_item","d":6,"p":{"lines":[32,33],"index":4},"v":"4. inline 行内"}]},{"t":"fence","d":5,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 通过rule对象的enforce属性指定前置和后置</span>\n<span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">enforce</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pre\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//前置</span>\n        <span class=\"token literal-property property\">enforce</span><span class=\"token operator\">:</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//后置</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n</code></pre>\n"}]},{"t":"heading","d":4,"p":{"lines":[45,46]},"v":"顺序：从右往左"}]},{"t":"heading","d":3,"p":{"lines":[47,48]},"v":"Pitching Loader","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">pitch</span> <span class=\"token operator\">=</span> <span class=\"token function\">fuction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> remainingRequest<span class=\"token punctuation\">,</span> precedingRequest</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"t":"heading","d":4,"p":{"lines":[55,56]},"v":"三个参数","c":[{"t":"list_item","d":6,"p":{"lines":[57,58],"index":1},"v":"1. data：用于数据传递，之后的normal中可以通过this.data获取"},{"t":"list_item","d":6,"p":{"lines":[58,59],"index":2},"v":"2. remainingRequest：剩余请求路径"},{"t":"list_item","d":6,"p":{"lines":[59,60],"index":3},"v":"3. precedingRequest：前置请求路径"}]},{"t":"heading","d":4,"p":{"lines":[61,62]},"v":"顺序","c":[{"t":"list_item","d":6,"p":{"lines":[63,64],"index":1},"v":"1. 默认为从左往右"},{"t":"list_item","d":6,"p":{"lines":[64,65],"index":2},"v":"2. 但是pitch可以中断，当pitch方法返回非undefined值时，则跳过剩余loader，掉头往回走"}]}]}]},{"t":"heading","d":2,"p":{"lines":[68,69]},"v":"编写Loader","c":[{"t":"ordered_list","d":3,"p":{"lines":[70,73],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[70,71],"index":1},"v":"1. Loader只进行转义工作，对拿到的source进行处理后返回"},{"t":"list_item","d":4,"p":{"lines":[71,72],"index":2},"v":"2. Webapck提供loaderUtils方便开发"}]},{"t":"heading","d":3,"p":{"lines":[73,74]},"v":"配置获取","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\">loaderUtils<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getOptions</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[79,80]},"v":"返回值","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 同步返回</span>\n<span class=\"token keyword control-flow\">return</span> value <span class=\"token comment\">// 只能一个值</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">callback</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">,</span> sourceMap<span class=\"token punctuation\">,</span> abstractSyntaxTree<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 可以多个值</span>\n\n<span class=\"token comment\">// 异步返回</span>\n<span class=\"token keyword\">var</span> callback <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">async</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//在异步回调中出发callback方法</span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[90,91]},"v":"简单插件实现","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> babel <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'babel-core'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">loader</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">source<span class=\"token punctuation\">,</span> inputSourceMap<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'es2015'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">inputSourceMap</span><span class=\"token operator\">:</span> inputSourceMap<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">sourceMaps</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">request</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span>\n        code<span class=\"token punctuation\">,</span>\n        map<span class=\"token punctuation\">,</span>\n        ast\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> babel<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">transform</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">,</span> map<span class=\"token punctuation\">,</span> ast<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> loader<span class=\"token punctuation\">;</span>\n</code></pre>\n"}]}]}]})</script>
</body>
</html>
