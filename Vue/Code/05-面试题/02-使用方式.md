# 使用方式

## 组件通信

### Vue不推荐子改父

Vue提倡父子组件间是单向数据流关系
1. 强行修改控制台vue会警告
2. 单向数据流破坏debug成本高

但是可以通过$emit触发父组件的方法，由父组件自主修改

### 组件通信方式

#### props / $emit

父组件向子组件传值
1. 父组件利用props向子组件传值，形成单向向下绑定
2. 可以定义一个或以上的数据，格式不限

父组件监听，子组件触发
1. $emit绑定一个自定义事件，事件执行时就会把参数传递给父组件
2. 父组件通过v-on监听并接收参数

#### 依赖注入（provide / inject）

provide用于提供数据或方法，inject用于注入数据或方法

注意！注入提供的属性是非响应式的

原理见（类构建/initMixin/initInjections与initProvide）

#### ref / $refs

设置ref，然后通过$refs获取对应子组件实例

#### $parent / $children

parent访问父组件的实例，根组件#app上拿$parent得到的是new Vue()的实例

children则是访问子组件的实例，但是有以下缺陷
1. 不能保证顺序
2. 访问的数据也不是响应式的
3. 最底层的子组件拿$children是个空数组

处理原理见（类构建/initMixin/initLifecycle）

#### $attrs / $listeners

attrs继承所有的父组件属性（除了prop传递的属性、class 和 style ），一般用于子组件元素上

listener属性是一个对象，里面包含了作用在这个组件上的所有监听器

```HTML
<!-- 将其父组件属性和监听直接传递给其子组件child -->
<child v-bind="$attrs" v-on="$listeners"></child>
```

处理原理见（类构建/initMixin/initRender)

#### eventBus（$emit / $on）

创建一个文件，内部创建一个Vue的实例化，组件触发该实例的emit和on对事件进行订阅和触发

但是项目过大，这个方式维护困难

原理见（类构建/eventsMixin）

#### Vuex

vue提供的一个全局状态管理类

### 组件通信总结

#### 父子间

1. props / $emit
2. ref / $refs
3. provide / inject（更多用于祖孙间）
4. $parent / $children

#### 兄弟间

1. eventBus
2. $parent / $refs

#### 全局

1. eventBus
2. vuex

## 事件修饰符

1. .stop：等价于event.stopPropagation()，阻止冒泡
2. .prevent：等价于event.preventDefault()，阻止默认行为
3. .capture：捕获触发
4. .self：只有自身范围事件触发，子元素不触发
5. .once：只触发一次

## 指令

### v-if、v-show、v-html

原理比较
1. v-if：调用addIfCondition，vnode生成时会忽略
2. v-show：vnode时会生成，render会增加display为none
3. v-html：移除下面所有节点，addProps添加innerHTML属性

#### v-if与v-show区别

1. 实现原理见上
2. 编译过程：v-if具有局部编译和卸载的过程，组件会销毁和重建，v-show只是简单css切换
3. 编译条件：v-if只在条件为真编译，v-show任何条件都会编译
4. 性能消耗：v-if的切换代价更高，v-show更适合频繁切换
5. 使用场景：可以用v-show的情况v-show优先

### v-model

是v-bind和v-on的语法糖，等价于

```HTML
<child :value="message" @input="function(e){message = e}"></child>
```

但是单选框、复选框等控件，触发的不是input事件，但是vue提供了model属性处理这个情况

```JS
model: {
    prop: 'checked',
    event: 'change'
},
```

## 使用技巧

### vue初始化页面闪动

vue初始化前，代码还没解析模板前会看到类似{{}}

1. 添加样式

```CSS
[v-cloak] {
    display: none;
}
```

2. 根元素添加元素

```HTML
<div style="display: none;" :style="{display: 'block'}"></div>
```
