<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"缓存机制","c":[{"t":"heading","d":2,"p":{"lines":[4,5]},"v":"缓存优点","c":[{"t":"list_item","d":4,"p":{"lines":[6,7],"index":1},"v":"1. 减少服务器的负担（减少请求次数和减少多余数据传输）"},{"t":"list_item","d":4,"p":{"lines":[7,8],"index":2},"v":"2. 加快网页的加载速度"}]},{"t":"heading","d":2,"p":{"lines":[9,10]},"v":"<a href=\"https://blog.csdn.net/zhaowanwan/article/details/111181013\">缓存位置</a>","c":[{"t":"heading","d":3,"p":{"lines":[11,12]},"v":"缓存位置分类","c":[{"t":"heading","d":4,"p":{"lines":[13,14]},"v":"Service Worker","c":[{"t":"ordered_list","d":5,"p":{"lines":[15,18],"start":1},"v":"","c":[{"t":"list_item","d":6,"p":{"lines":[15,16],"index":1},"v":"1. 工作者线程之一，拦截HTTP请求，利用CacheStorage缓存"},{"t":"list_item","d":6,"p":{"lines":[16,17],"index":2},"v":"2. 缓存是持续性的"}]},{"t":"heading","d":5,"p":{"lines":[18,19]},"v":"Service Worker缓存获取方式","c":[{"t":"list_item","d":7,"p":{"lines":[20,21],"index":1},"v":"1. Service Worker未命中缓存则从缓存优先级中其他方式获取数据，都没有则调用fetch函数获取数据"},{"t":"list_item","d":7,"p":{"lines":[21,22],"index":2},"v":"2. 但是无论是从Memory Cache还是网络获取数据都显示为Service Worker获取数据"}]}]},{"t":"heading","d":4,"p":{"lines":[23,24]},"v":"Memory Cache","c":[{"t":"list_item","d":6,"p":{"lines":[25,26],"index":1},"v":"1. 内存中的缓存，效率快"},{"t":"list_item","d":6,"p":{"lines":[26,27],"index":2},"v":"2. 页面关闭缓存丢失"}]},{"t":"heading","d":4,"p":{"lines":[28,29]},"v":"Disk Cache","c":[{"t":"list_item","d":6,"p":{"lines":[30,31],"index":1},"v":"1. 硬盘上的缓存"},{"t":"list_item","d":6,"p":{"lines":[31,32],"index":2},"v":"2. 缓存是持续性的，除非手动清理"},{"t":"list_item","d":6,"p":{"lines":[32,33],"index":3},"v":"3. 通过header字段判断是否缓存，一旦存下来，就不会再次请求"}]},{"t":"heading","d":4,"p":{"lines":[34,35]},"v":"Push Cache","c":[{"t":"list_item","d":6,"p":{"lines":[36,37],"index":1},"v":"1. HTTP2中的服务器推送缓存"},{"t":"list_item","d":6,"p":{"lines":[37,38],"index":2},"v":"2. 所有资源都可以推送"},{"t":"list_item","d":6,"p":{"lines":[38,39],"index":3},"v":"3. 可以推送no-cache和no-store的资源"},{"t":"list_item","d":6,"p":{"lines":[39,40],"index":4},"v":"4. 一旦连接关闭，就会被释放"},{"t":"list_item","d":6,"p":{"lines":[40,41],"index":5},"v":"5. 缓存只能使用一次"},{"t":"list_item","d":6,"p":{"lines":[41,42],"index":6},"v":"6. 可以给其他域名推送"},{"t":"list_item","d":6,"p":{"lines":[42,43],"index":7},"v":"7. 浏览器可以拒绝接受已经存在的资源推送"}]}]},{"t":"heading","d":3,"p":{"lines":[44,45]},"v":"缓存位置优先级：Service Worker &gt; Memory Cache &gt; Disk Cache &gt; 网络"},{"t":"heading","d":3,"p":{"lines":[46,47]},"v":"chrome控制台状态","c":[{"t":"list_item","d":5,"p":{"lines":[48,49],"index":1},"v":"1. 200","c":[{"t":"list_item","d":7,"p":{"lines":[49,50],"index":1},"v":"1. 强制缓存","c":[{"t":"list_item","d":9,"p":{"lines":[50,51],"index":1},"v":"1. from memory cache"},{"t":"list_item","d":9,"p":{"lines":[51,52],"index":2},"v":"2. from disk cache"}]},{"t":"list_item","d":7,"p":{"lines":[52,53],"index":2},"v":"2. 网络资源（资源大小数值）"}]},{"t":"list_item","d":5,"p":{"lines":[53,54],"index":2},"v":"2. 304","c":[{"t":"list_item","d":7,"p":{"lines":[54,55],"index":1},"v":"1. 协商缓存（报文大小）"}]}]}]},{"t":"heading","d":2,"p":{"lines":[56,57]},"v":"缓存方式","c":[{"t":"heading","d":3,"p":{"lines":[60,61]},"v":"强缓存","c":[{"t":"heading","d":4,"p":{"lines":[64,65]},"v":"Expires（不使用）","c":[{"t":"fence","d":5,"v":"<pre><code>Expires: Thu, 10 Nov 2017 08:45:11 GMT\n</code></pre>\n"},{"t":"heading","d":5,"p":{"lines":[72,73]},"v":"缺点","c":[{"t":"list_item","d":7,"p":{"lines":[74,75],"index":1},"v":"1. 绝对时间，受客户端时间影响，推荐Cache-control"},{"t":"list_item","d":7,"p":{"lines":[75,76],"index":2},"v":"2. 写法复杂"}]}]},{"t":"heading","d":4,"p":{"lines":[77,78]},"v":"Cache-control（优先级高于Expires）","c":[{"t":"fence","d":5,"v":"<pre><code>Cache-control: max-age=2592000\n\nCache-control: no-cache\n</code></pre>\n"},{"t":"heading","d":5,"p":{"lines":[87,88]},"v":"可缓存性","c":[{"t":"ordered_list","d":6,"p":{"lines":[89,94],"start":1},"v":"","c":[{"t":"list_item","d":7,"p":{"lines":[89,90],"index":1},"v":"1. public：可被任何对象缓存（包括代理服务器），即使是通常不可缓存内容"},{"t":"list_item","d":7,"p":{"lines":[90,91],"index":2},"v":"2. private：只允许单个用户缓存，禁止共享缓存"},{"t":"list_item","d":7,"p":{"lines":[91,92],"index":3},"v":"3. no-cache：会向服务器确认缓存是否失效"},{"t":"list_item","d":7,"p":{"lines":[92,93],"index":4},"v":"4. no-store：不使用任何缓存"}]},{"t":"heading","d":6,"p":{"lines":[94,95]},"v":"no-cache与no-store具有以下区别","c":[{"t":"list_item","d":8,"p":{"lines":[96,97],"index":1},"v":"1. no-cache代表放弃强缓存，但是协商缓存可使用"},{"t":"list_item","d":8,"p":{"lines":[97,98],"index":2},"v":"2. no-store代表放弃全部缓存，直接网络请求资源"}]}]},{"t":"heading","d":5,"p":{"lines":[99,100]},"v":"到期时间","c":[{"t":"list_item","d":7,"p":{"lines":[101,102],"index":1},"v":"1. max-age=seconds：设置缓存存储的最大周期，超过这个时间缓存被认为过期"},{"t":"list_item","d":7,"p":{"lines":[102,103],"index":2},"v":"2. s-maxage=seconds：覆盖max-age或者Expires头，仅适用于共享缓存(比如各个代理)，私有缓存会忽略"},{"t":"list_item","d":7,"p":{"lines":[103,104],"index":3},"v":"3. max-stale=seconds：客户端愿意接收一个已经过期的资源，不能超过给定的时间限制"}]}]}]},{"t":"heading","d":3,"p":{"lines":[105,106]},"v":"协商缓存","c":[{"t":"heading","d":4,"p":{"lines":[107,108]},"v":"命中条件","c":[{"t":"list_item","d":6,"p":{"lines":[109,110],"index":1},"v":"1. Cache-control: max-age=xxx 过期"},{"t":"list_item","d":6,"p":{"lines":[110,111],"index":2},"v":"2. Cache-control: no-cache"}]},{"t":"heading","d":4,"p":{"lines":[112,113]},"v":"请求过程","c":[{"t":"list_item","d":6,"p":{"lines":[114,115],"index":1},"v":"1. 未修改，返回304，使用本地缓存"},{"t":"list_item","d":6,"p":{"lines":[115,116],"index":2},"v":"2. 修改，获取服务器最新数据，返回200"}]},{"t":"heading","d":4,"p":{"lines":[117,118]},"v":"Last-Modified","c":[{"t":"heading","d":5,"p":{"lines":[121,122]},"v":"Last-Modified使用方式","c":[{"t":"fence","d":6,"v":"<pre><code>Last-Modified : Fri , 12 May 2006 18:53:33 GMT\n</code></pre>\n"},{"t":"fence","d":6,"v":"<pre><code>If-Modified-Since : Fri , 12 May 2006 18:53:33 GMT\n</code></pre>\n"}]}]},{"t":"heading","d":4,"p":{"lines":[135,136]},"v":"<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag\">Etag</a>","c":[{"t":"ordered_list","d":5,"p":{"lines":[137,140],"start":1},"v":"","c":[{"t":"list_item","d":6,"p":{"lines":[137,138],"index":1},"v":"1. 资源的特定版本的标识符，Etag 的优先级高于 Last-Modified"},{"t":"list_item","d":6,"p":{"lines":[138,139],"index":2},"v":"2. 每个服务器上 Etag 的值都不一样，因此在考虑负载平衡时，最好不要设置 Etag 属性"}]},{"t":"heading","d":5,"p":{"lines":[140,141]},"v":"Etag的使用方式","c":[{"t":"fence","d":6,"v":"<pre><code>ETag: &quot;686897696a7c876b7e&quot;\n</code></pre>\n"},{"t":"fence","d":6,"v":"<pre><code>If-None-Match: &quot;686897696a7c876b7e&quot;\n</code></pre>\n"}]}]}]}]},{"t":"heading","d":2,"p":{"lines":[154,155]},"v":"刷新机制对比","c":[{"t":"heading","d":3,"p":{"lines":[156,157]},"v":"刷新按钮/F5","c":[{"t":"list_item","d":5,"p":{"lines":[158,159],"index":1},"v":"1. 强制缓存过期"},{"t":"list_item","d":5,"p":{"lines":[159,160],"index":2},"v":"2. 协商缓存有效"}]},{"t":"heading","d":3,"p":{"lines":[161,162]},"v":"Ctrl+F5（强制缓存）","c":[{"t":"list_item","d":5,"p":{"lines":[163,164],"index":1},"v":"1. 缓存全部失效"}]},{"t":"heading","d":3,"p":{"lines":[165,166]},"v":"地址栏回车","c":[{"t":"list_item","d":5,"p":{"lines":[167,168],"index":1},"v":"1. 正常流程"}]}]}]})</script>
</body>
</html>
