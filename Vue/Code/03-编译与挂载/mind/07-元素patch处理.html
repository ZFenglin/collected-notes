<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"root","d":0,"v":"","c":[{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"元素patch处理","c":[{"t":"ordered_list","d":2,"p":{"lines":[6,16],"start":1},"v":"","c":[{"t":"list_item","d":3,"p":{"lines":[6,7],"index":1},"v":"1. 如果vnode未定义，则直接返回，若存在oldVnode，则同时销毁oldVnode"},{"t":"list_item","d":3,"p":{"lines":[7,8],"index":2},"v":"2. 若oldVnode未定义（很可能是组件挂载，或初始化），则直接createElm创建新元素"},{"t":"list_item","d":3,"p":{"lines":[8,9],"index":3},"v":"3. oldVnode存在，则分条件判断如何更新","c":[{"t":"list_item","d":5,"p":{"lines":[9,10],"index":1},"v":"1. 新旧节点sameVnode相同，则执行patchVnode，用diff处理"},{"t":"list_item","d":5,"p":{"lines":[10,11],"index":2},"v":"2. 否则替换当前元素","c":[{"t":"list_item","d":7,"p":{"lines":[11,12],"index":1},"v":"1. 获取当前旧节点和他的父亲"},{"t":"list_item","d":7,"p":{"lines":[12,13],"index":2},"v":"2. 创建新元素，内部包含组件的初始化逻辑"},{"t":"list_item","d":7,"p":{"lines":[13,14],"index":3},"v":"3. 递归更新占位符"},{"t":"list_item","d":7,"p":{"lines":[14,15],"index":4},"v":"4. 销毁旧组件"}]}]}]},{"t":"fence","d":2,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createPatchFunction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">backend</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 处理patch所需的方法和属性</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token comment\">// 返回patch方法</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">patch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">,</span> hydrating<span class=\"token punctuation\">,</span> removeOnly</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 如果vnode未定义，则直接返回</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// oldVnode定义了，则销毁oldVnode的Hook</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token function\">invokeDestroyHook</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword control-flow\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> isInitialPatch <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">const</span> insertedVnodeQueue <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 若oldVnode未定义（很可能是组件挂载，或初始化），则直接createElm创建新元素</span>\n            isInitialPatch <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// oldVnode存在，则分条件判断如何更新</span>\n            <span class=\"token keyword\">const</span> isRealElement <span class=\"token operator\">=</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">nodeType</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isRealElement <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// 新旧节点sameVnode相同，则执行patchVnode</span>\n                <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> removeOnly<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// 否则替换当前元素</span>\n                <span class=\"token comment\">// ...</span>\n                <span class=\"token comment\">// 获取当前旧节点和他的父亲</span>\n                <span class=\"token keyword\">const</span> oldElm <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span>\n                <span class=\"token keyword\">const</span> parentElm <span class=\"token operator\">=</span> nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parentNode</span><span class=\"token punctuation\">(</span>oldElm<span class=\"token punctuation\">)</span>\n                <span class=\"token comment\">// 创建新元素，内部包含组件的初始化逻辑</span>\n                <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span>\n                    vnode<span class=\"token punctuation\">,</span>\n                    insertedVnodeQueue<span class=\"token punctuation\">,</span>\n                    oldElm<span class=\"token punctuation\">.</span><span class=\"token property-access\">_leaveCb</span> <span class=\"token operator\">?</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">:</span> parentElm<span class=\"token punctuation\">,</span>\n                    nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">nextSibling</span><span class=\"token punctuation\">(</span>oldElm<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token comment\">// 递归更新占位符</span>\n                <span class=\"token comment\">// ...</span>\n                <span class=\"token comment\">// 销毁旧组件</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">removeVnodes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>oldVnode<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">tag</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">invokeDestroyHook</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 调用插入的钩子 => callInsert</span>\n        <span class=\"token function\">invokeInsertHook</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> isInitialPatch<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword control-flow\">return</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":1,"p":{"lines":[72,73]},"v":"patchVnode","c":[{"t":"ordered_list","d":2,"p":{"lines":[74,86],"start":1},"v":"","c":[{"t":"list_item","d":3,"p":{"lines":[74,75],"index":1},"v":"1. 新旧节点一致，则直接返回"},{"t":"list_item","d":3,"p":{"lines":[75,76],"index":2},"v":"2. 异步组件处理"},{"t":"list_item","d":3,"p":{"lines":[76,77],"index":3},"v":"3. 静态组件直接返回"},{"t":"list_item","d":3,"p":{"lines":[77,78],"index":4},"v":"4. 组件prepatch钩子触发"},{"t":"list_item","d":3,"p":{"lines":[78,79],"index":5},"v":"5. 节点比对","c":[{"t":"list_item","d":5,"p":{"lines":[79,80],"index":1},"v":"1. 非文本标签处理","c":[{"t":"list_item","d":7,"p":{"lines":[80,81],"index":1},"v":"1. 新旧孩子都有，调用updateChildren使用diff更新孩子"},{"t":"list_item","d":7,"p":{"lines":[81,82],"index":2},"v":"2. 仅有新孩子，直接添加新孩子"},{"t":"list_item","d":7,"p":{"lines":[82,83],"index":3},"v":"3. 仅有旧孩子，直接删除旧孩子"}]},{"t":"list_item","d":5,"p":{"lines":[83,84],"index":2},"v":"2. 文本标签，则直接替换"}]},{"t":"list_item","d":3,"p":{"lines":[84,85],"index":6},"v":"6. postpatch钩子触发"}]},{"t":"fence","d":2,"v":"<pre class=\"language-js\"><code class=\"language-js\">  <span class=\"token keyword\">function</span> <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">oldVnode<span class=\"token punctuation\">,</span>\n      vnode<span class=\"token punctuation\">,</span>\n      insertedVnodeQueue<span class=\"token punctuation\">,</span>\n      ownerArray<span class=\"token punctuation\">,</span>\n      index<span class=\"token punctuation\">,</span>\n      removeOnly</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 1. 新旧节点一致，则直接返回</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>oldVnode <span class=\"token operator\">===</span> vnode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>ownerArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          vnode <span class=\"token operator\">=</span> ownerArray<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">cloneVNode</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">const</span> elm <span class=\"token operator\">=</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span> <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span>\n      <span class=\"token comment\">// 2. 异步组件处理</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isTrue</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">isAsyncPlaceholder</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">asyncFactory</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">resolved</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">hydrate</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n              vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">isAsyncPlaceholder</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword control-flow\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 3. 静态组件直接返回</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isTrue</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">isStatic</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n          <span class=\"token function\">isTrue</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">isStatic</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n          vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span> <span class=\"token operator\">===</span> oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span> <span class=\"token operator\">&amp;&amp;</span>\n          <span class=\"token punctuation\">(</span><span class=\"token function\">isTrue</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">isCloned</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">isTrue</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">isOnce</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">componentInstance</span> <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">componentInstance</span>\n          <span class=\"token keyword control-flow\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 4. 组件prepatch钩子触发</span>\n      <span class=\"token keyword\">let</span> i\n      <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">hook</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> i<span class=\"token punctuation\">.</span><span class=\"token property-access\">prepatch</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">i</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">const</span> oldCh <span class=\"token operator\">=</span> oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span>\n      <span class=\"token keyword\">const</span> ch <span class=\"token operator\">=</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isPatchable</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> cbs<span class=\"token punctuation\">.</span><span class=\"token property-access\">update</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> cbs<span class=\"token punctuation\">.</span><span class=\"token property-access\">update</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">hook</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> i<span class=\"token punctuation\">.</span><span class=\"token property-access\">update</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token function\">i</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 5. 节点比对</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">text</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 非文本标签处理</span>\n          <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// 新旧孩子都有，调用updateChildren使用diff更新孩子</span>\n              <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>oldCh <span class=\"token operator\">!==</span> ch<span class=\"token punctuation\">)</span> <span class=\"token function\">updateChildren</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">,</span> ch<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> removeOnly<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// 仅有新孩子</span>\n              <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">text</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setTextContent</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 清空旧孩子的文本</span>\n              <span class=\"token comment\">// 增加新孩子</span>\n              <span class=\"token function\">addVnodes</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> ch<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ch<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// 仅有旧孩子</span>\n              <span class=\"token function\">removeVnodes</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">text</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// 新旧都没孩子，但是旧的存在文本</span>\n              nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setTextContent</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">text</span> <span class=\"token operator\">!==</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">text</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 文本标签处理</span>\n          nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setTextContent</span><span class=\"token punctuation\">(</span>elm<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">text</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 6. postpatch钩子触发</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">hook</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> i<span class=\"token punctuation\">.</span><span class=\"token property-access\">postpatch</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token function\">i</span><span class=\"token punctuation\">(</span>oldVnode<span class=\"token punctuation\">,</span> vnode<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":1,"p":{"lines":[163,164]},"v":"updateChildren","c":[{"t":"ordered_list","d":2,"p":{"lines":[170,186],"start":1},"v":"","c":[{"t":"list_item","d":3,"p":{"lines":[170,171],"index":1},"v":"1. 旧节点为空处理"},{"t":"list_item","d":3,"p":{"lines":[171,172],"index":2},"v":"2. 头头相同，头节点后移"},{"t":"list_item","d":3,"p":{"lines":[172,173],"index":3},"v":"3. 尾尾相同，尾节点前移"},{"t":"list_item","d":3,"p":{"lines":[173,174],"index":4},"v":"4. 头尾相同，右移，旧头节点移动至旧尾节点后，头节点后移，尾节点前移"},{"t":"list_item","d":3,"p":{"lines":[174,175],"index":5},"v":"5. 尾头相同，左移，旧尾节点移动至旧头节点前，头节点后移，尾节点前移"},{"t":"list_item","d":3,"p":{"lines":[175,176],"index":6},"v":"6. 乱序处理","c":[{"t":"list_item","d":5,"p":{"lines":[176,177],"index":1},"v":"1. 获取旧节点映射oldKeyToIdx"},{"t":"list_item","d":5,"p":{"lines":[177,178],"index":2},"v":"2. 获取映射中与新头节点key相同的值"},{"t":"list_item","d":5,"p":{"lines":[178,179],"index":3},"v":"3. 是否存在映射的值","c":[{"t":"list_item","d":7,"p":{"lines":[179,180],"index":1},"v":"1. 不存在直接创建节点，并插到旧头节点之前"},{"t":"list_item","d":7,"p":{"lines":[180,181],"index":2},"v":"2. 存在，则获取节点，看节点是否相同分别处理"}]},{"t":"list_item","d":5,"p":{"lines":[181,182],"index":4},"v":"4. 新头节点index后移"}]},{"t":"list_item","d":3,"p":{"lines":[182,183],"index":7},"v":"7. 剩余节点处理","c":[{"t":"list_item","d":5,"p":{"lines":[183,184],"index":1},"v":"1. 新节点剩余，添加新节点"},{"t":"list_item","d":5,"p":{"lines":[184,185],"index":2},"v":"2. 旧节点剩余，删除旧节点"}]}]},{"t":"fence","d":2,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">updateChildren</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">parentElm<span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> removeOnly</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> oldStartIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">let</span> newStartIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">let</span> oldEndIdx <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">let</span> oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">let</span> oldEndVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span>oldEndIdx<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">let</span> newEndIdx <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">let</span> newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">let</span> newEndVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span>newEndIdx<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">let</span> oldKeyToIdx<span class=\"token punctuation\">,</span> idxInOld<span class=\"token punctuation\">,</span> vnodeToMove<span class=\"token punctuation\">,</span> refElm\n    <span class=\"token keyword\">const</span> canMove <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>removeOnly\n    <span class=\"token comment\">// diff双指针</span>\n    <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span>oldStartIdx <span class=\"token operator\">&lt;=</span> oldEndIdx <span class=\"token operator\">&amp;&amp;</span> newStartIdx <span class=\"token operator\">&lt;=</span> newEndIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 旧开始节点为空</span>\n            oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>oldStartIdx<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 旧结束节点为空</span>\n            oldEndVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>oldEndIdx<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 旧开始节点和新开始节点相同</span>\n            <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newStartIdx<span class=\"token punctuation\">)</span>\n            oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>oldStartIdx<span class=\"token punctuation\">]</span>\n            newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 旧结束节点和新结束节点相同</span>\n            <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newEndIdx<span class=\"token punctuation\">)</span>\n            oldEndVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>oldEndIdx<span class=\"token punctuation\">]</span>\n            newEndVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>newEndIdx<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 旧开始节点和新结束节点相同</span>\n            <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldStartVnode<span class=\"token punctuation\">,</span> newEndVnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newEndIdx<span class=\"token punctuation\">)</span>\n            canMove <span class=\"token operator\">&amp;&amp;</span> nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">,</span> nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">nextSibling</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            oldStartVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>oldStartIdx<span class=\"token punctuation\">]</span>\n            newEndVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>newEndIdx<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 旧结束节点和新开始节点相同</span>\n            <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>oldEndVnode<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newStartIdx<span class=\"token punctuation\">)</span>\n            canMove <span class=\"token operator\">&amp;&amp;</span> nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> oldEndVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">)</span>\n            oldEndVnode <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>oldEndIdx<span class=\"token punctuation\">]</span>\n            newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 乱序diff处理</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>oldKeyToIdx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> oldKeyToIdx <span class=\"token operator\">=</span> <span class=\"token function\">createKeyToOldIdx</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">,</span> oldStartIdx<span class=\"token punctuation\">,</span> oldEndIdx<span class=\"token punctuation\">)</span>\n            idxInOld <span class=\"token operator\">=</span> <span class=\"token function\">isDef</span><span class=\"token punctuation\">(</span>newStartVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span>\n                oldKeyToIdx<span class=\"token punctuation\">[</span>newStartVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">key</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span>\n                <span class=\"token function\">findIdxInOld</span><span class=\"token punctuation\">(</span>newStartVnode<span class=\"token punctuation\">,</span> oldCh<span class=\"token punctuation\">,</span> oldStartIdx<span class=\"token punctuation\">,</span> oldEndIdx<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>idxInOld<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span>newStartVnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> parentElm<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newStartIdx<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                vnodeToMove <span class=\"token operator\">=</span> oldCh<span class=\"token punctuation\">[</span>idxInOld<span class=\"token punctuation\">]</span>\n                <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sameVnode</span><span class=\"token punctuation\">(</span>vnodeToMove<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">patchVnode</span><span class=\"token punctuation\">(</span>vnodeToMove<span class=\"token punctuation\">,</span> newStartVnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newStartIdx<span class=\"token punctuation\">)</span>\n                    oldCh<span class=\"token punctuation\">[</span>idxInOld<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword nil\">undefined</span>\n                    canMove <span class=\"token operator\">&amp;&amp;</span> nodeOps<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertBefore</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> vnodeToMove<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">createElm</span><span class=\"token punctuation\">(</span>newStartVnode<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">,</span> parentElm<span class=\"token punctuation\">,</span> oldStartVnode<span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newStartIdx<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            newStartVnode <span class=\"token operator\">=</span> newCh<span class=\"token punctuation\">[</span><span class=\"token operator\">++</span>newStartIdx<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>oldStartIdx <span class=\"token operator\">></span> oldEndIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        refElm <span class=\"token operator\">=</span> <span class=\"token function\">isUndef</span><span class=\"token punctuation\">(</span>newCh<span class=\"token punctuation\">[</span>newEndIdx <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">:</span> newCh<span class=\"token punctuation\">[</span>newEndIdx <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">elm</span>\n        <span class=\"token function\">addVnodes</span><span class=\"token punctuation\">(</span>parentElm<span class=\"token punctuation\">,</span> refElm<span class=\"token punctuation\">,</span> newCh<span class=\"token punctuation\">,</span> newStartIdx<span class=\"token punctuation\">,</span> newEndIdx<span class=\"token punctuation\">,</span> insertedVnodeQueue<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>newStartIdx <span class=\"token operator\">></span> newEndIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">removeVnodes</span><span class=\"token punctuation\">(</span>oldCh<span class=\"token punctuation\">,</span> oldStartIdx<span class=\"token punctuation\">,</span> oldEndIdx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}],"p":{}})</script>
</body>
</html>
