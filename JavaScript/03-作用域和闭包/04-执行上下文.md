# 执行上下文

## 执行上下文分类

执行上下文分为三类
1. 全局执行上下文
2. 函数执行上下文
3. Eval上下文

### 全局执行上下文

JS脚本解析时会创建全局上下文

增加变量this

### 函数执行上下文

函数执行前会创建函数上下文

增加变量this、arguments和函数参数

### Eval上下文

执行 eval函数内部的代码也有属于它的上下文，由于开发中是尽量避免或不用eval函数，故此不作讨论

## 上下文结构

### 相关概念

#### Scope

作用域，名称查找变量的一套规则

#### VO

变量对象，Variable Object

在上下文中定义的变量和函数声明

#### AO

活动对象，Active Object

创建函数的时候初始化的一个对象，包含变量对象中的内容

通常为VO + 函数参数变量 + arguments

#### this

上下文创建时指定的一个对象

### 结构组成

#### 全局执行上下文

1. Scope
2. VO
3. this

#### 函数执行上下文

1. Scope
2. AO
3. this

## 执行栈ECS

执行栈就是解释引擎记录执行上下文的容器，栈底是全局执行上下文，栈顶是当前正在执行的上下文

理解执行栈，推荐先去理解浏览器的JavaScript的执行方式

### 运行方式

1. JS执行时，首先压入全局执行上下文
2. 每当函数调用时，会为该函数创建上下文并压入栈顶，执行完成后该上下文弹出，转至上一层上下文
3. 全部执行完成后，全局上下文弹出

## [上下文创建过程](https://blog.csdn.net/yangxinxiang84/article/details/113051811)

### 全局执行上下文创建

![全局执行上下文创建](assets/04-全局上下文创建.png)

### 函数执行上下文创建

![函数执行上下文创建](assets/04-函数上下文创建.png)

## 执行上下文与作用域区别

1. 执行上下文在运行时确定，随时可能改变
2. 作用域在定义时就确定，并且不会改变
