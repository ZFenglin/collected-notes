<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"Promise","c":[{"t":"heading","d":2,"p":{"lines":[2,3]},"v":"Promise概念","c":[{"t":"heading","d":3,"p":{"lines":[4,5]},"v":"三个状态","c":[{"t":"list_item","d":5,"p":{"lines":[6,7],"index":1},"v":"1. pending（待定）"},{"t":"list_item","d":5,"p":{"lines":[7,8],"index":2},"v":"2. fullfilled（兑现，也有resolved）"},{"t":"list_item","d":5,"p":{"lines":[8,9],"index":3},"v":"3. rejected（拒绝）"}]},{"t":"heading","d":3,"p":{"lines":[10,11]},"v":"两个过程","c":[{"t":"ordered_list","d":4,"p":{"lines":[12,15],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[12,13],"index":1},"v":"1. pending =&gt; resolve（触发onFulfilled）"},{"t":"list_item","d":5,"p":{"lines":[13,14],"index":2},"v":"2. pending =&gt; rejected（触发onRejected）"}]},{"t":"heading","d":4,"p":{"lines":[15,16]},"v":"过程特点","c":[{"t":"list_item","d":6,"p":{"lines":[17,18],"index":3},"v":"3. 变化不可逆"},{"t":"list_item","d":6,"p":{"lines":[18,19],"index":4},"v":"4. 结果事件将会放在微任务队列中等待执行"}]}]}]},{"t":"heading","d":2,"p":{"lines":[20,21]},"v":"Promise方法","c":[{"t":"heading","d":3,"p":{"lines":[22,23]},"v":"构造函数","c":[{"t":"heading","d":4,"p":{"lines":[24,25]},"v":"Promise()"}]},{"t":"heading","d":3,"p":{"lines":[28,29]},"v":"实例方法(Promise.prototype)","c":[{"t":"heading","d":4,"p":{"lines":[30,31]},"v":".then","c":[{"t":"list_item","d":6,"p":{"lines":[34,35],"index":1},"v":"1. then会返回一个全新的Promise对象"},{"t":"list_item","d":6,"p":{"lines":[35,36],"index":2},"v":"2. then方法就是为上一个then返回Promise注册回调"},{"t":"list_item","d":6,"p":{"lines":[36,37],"index":3},"v":"3. then的返回值会作为后续的then方法的回调参数"}]},{"t":"heading","d":4,"p":{"lines":[38,39]},"v":".catch"},{"t":"heading","d":4,"p":{"lines":[42,43]},"v":".finally"}]},{"t":"heading","d":3,"p":{"lines":[46,47]},"v":"静态方法(Promise)","c":[{"t":"heading","d":4,"p":{"lines":[48,49]},"v":"Promise.all(iterable)","c":[{"t":"heading","d":5,"p":{"lines":[54,55]},"v":"Promise.all原理","c":[{"t":"list_item","d":7,"p":{"lines":[56,57],"index":1},"v":"1. 返回一个Promise","c":[{"t":"list_item","d":9,"p":{"lines":[57,58],"index":1},"v":"1. 维护一个结果数组promisesResults"},{"t":"list_item","d":9,"p":{"lines":[58,59],"index":2},"v":"2. 遍历promises，Promise.resolve(promise)封装，在then时处理成功和失败","c":[{"t":"list_item","d":11,"p":{"lines":[59,60],"index":1},"v":"1. 成功时，看promisesResults的长度，判断是否完全处理完，看是否触发resolve(promisesResults)"},{"t":"list_item","d":11,"p":{"lines":[60,61],"index":2},"v":"2. 失败直接reject(res)"}]}]}]}]},{"t":"heading","d":4,"p":{"lines":[64,65]},"v":"Promise.allSettled(iterable)"},{"t":"heading","d":4,"p":{"lines":[68,69]},"v":"Promise.any(iterable)"},{"t":"heading","d":4,"p":{"lines":[72,73]},"v":"Promise.race(iterable)","c":[{"t":"heading","d":5,"p":{"lines":[76,77]},"v":"Promise.race原理","c":[{"t":"list_item","d":7,"p":{"lines":[78,79],"index":1},"v":"1. 与Promise.all差不多，Promise.resolve(promise)外部差不多，没有需要维护的数组"},{"t":"list_item","d":7,"p":{"lines":[79,80],"index":2},"v":"2. then内部则是谁先触发谁resolve(res)或reject(res)"}]},{"t":"heading","d":5,"p":{"lines":[83,84]},"v":"Promise.race实现执行中断","c":[{"t":"fence","d":6,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token known-class-name class-name\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">race</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>promise1<span class=\"token punctuation\">,</span> <span class=\"token function\">timeOutPromise</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n"}]}]},{"t":"heading","d":4,"p":{"lines":[91,92]},"v":"Promise.reject(reason)"},{"t":"heading","d":4,"p":{"lines":[95,96]},"v":"Promise.resolve(value)","c":[{"t":"list_item","d":6,"p":{"lines":[99,100],"index":1},"v":"1. value为带有then方法的对象：返回的Promise对象的最终状态由then方法执行决定"},{"t":"list_item","d":6,"p":{"lines":[100,101],"index":2},"v":"2. value为其他：返回的Promise对象状态为fulfilled，并且将该value传递给对应的then方法"}]}]}]},{"t":"heading","d":2,"p":{"lines":[102,103]},"v":"链式调用","c":[{"t":"heading","d":3,"p":{"lines":[106,107]},"v":"Promise执行方法判断","c":[{"t":"list_item","d":5,"p":{"lines":[112,113],"index":1},"v":"1. 当没有设定状态时，默认状态是resolved，触发最近的then"},{"t":"list_item","d":5,"p":{"lines":[113,114],"index":2},"v":"2. 当内部报错时，默认状态为rejected，触发最近的catch"}]},{"t":"heading","d":3,"p":{"lines":[115,116]},"v":"<a href=\"https://juejin.cn/post/6844903987183894535\">执行顺序判断</a>","c":[{"t":"ordered_list","d":4,"p":{"lines":[117,120],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[117,118],"index":1},"v":"1. 微任务回调事件按照注册顺序执行"},{"t":"list_item","d":5,"p":{"lines":[118,119],"index":2},"v":"2. 任何一个异常都会不断向后执行直到捕获"}]},{"t":"heading","d":4,"p":{"lines":[120,121]},"v":"then与catch的注册时机","c":[{"t":"fence","d":5,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 所有then同时注册</span>\n<span class=\"token comment\">// 1. 先创建Promise实例</span>\n<span class=\"token keyword\">let</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\np<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 2. return直接返回Promise实例</span>\n<span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n"},{"t":"fence","d":5,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 按照回调执行后注册</span>\n<span class=\"token comment\">// 会等待第一个then执行完后再注册第二个</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n"}]}]}]},{"t":"heading","d":2,"p":{"lines":[138,139]},"v":"Promise原理","c":[{"t":"list_item","d":4,"p":{"lines":[142,143],"index":1},"v":"1. 利用数组保存回调"},{"t":"list_item","d":4,"p":{"lines":[143,144],"index":2},"v":"2. 在下一个循环执行resolve和reject"},{"t":"list_item","d":4,"p":{"lines":[144,145],"index":3},"v":"3. 按照执行结果是否instanceof _Promise，决定是否继续执行then"},{"t":"list_item","d":4,"p":{"lines":[145,146],"index":4},"v":"4. then返回一个_Promise对象"},{"t":"list_item","d":4,"p":{"lines":[146,147],"index":5},"v":"5. catch返回一个只注册onRejected的then的执行结果"}]}]})</script>
</body>
</html>
