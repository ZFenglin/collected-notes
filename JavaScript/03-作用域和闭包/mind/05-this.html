<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"this","c":[{"t":"heading","d":2,"p":{"lines":[2,3]},"v":"this概念","c":[{"t":"heading","d":3,"p":{"lines":[4,5]},"v":"this和词法作用域不要混淆","c":[{"t":"list_item","d":5,"p":{"lines":[6,7],"index":1},"v":"1. this 是在运行时进行绑定的，并不是在编写时绑定，它的上下文取决于函数调用时的各种条件"},{"t":"list_item","d":5,"p":{"lines":[7,8],"index":2},"v":"2. this 的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式"}]},{"t":"heading","d":3,"p":{"lines":[9,10]},"v":"调用位置","c":[{"t":"list_item","d":5,"p":{"lines":[11,12],"index":1},"v":"1. 分析this需要明确调用位置"},{"t":"list_item","d":5,"p":{"lines":[12,13],"index":2},"v":"2. 调用位置就是函数在代码中被调用的位置（而不是声明的位置）"}]}]},{"t":"heading","d":2,"p":{"lines":[14,15]},"v":"绑定规则","c":[{"t":"heading","d":3,"p":{"lines":[16,17]},"v":"绑定规则优先级（new &gt; 显式绑定 &gt; 隐式绑定 &gt; 默认绑定）"},{"t":"heading","d":3,"p":{"lines":[18,19]},"v":"默认绑定","c":[{"t":"ordered_list","d":4,"p":{"lines":[20,24],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[20,21],"index":1},"v":"1. 直接使用不带任何修饰的函数引用进行调用的函数指向默认绑定"},{"t":"list_item","d":5,"p":{"lines":[21,22],"index":2},"v":"2. 函数默认绑定时，this指向全局对象"},{"t":"list_item","d":5,"p":{"lines":[22,23],"index":3},"v":"3. 严格模式下，默认模式不可用，this为undefined"}]},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[32,33]},"v":"隐式绑定","c":[{"t":"ordered_list","d":4,"p":{"lines":[34,37],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[34,35],"index":1},"v":"1. 隐式绑定是调用位置是否有上下文对象，或者说是否被某个对象拥有或者包含"},{"t":"list_item","d":5,"p":{"lines":[35,36],"index":2},"v":"2. 当函数引用有上下文对象时，隐式绑定规则会把函数调用中的 this 绑定到这个上下文对象"}]},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span>\n</code></pre>\n"},{"t":"heading","d":4,"p":{"lines":[48,49]},"v":"隐式丢失","c":[{"t":"fence","d":5,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 隐式绑定只取决于是否存在有上下文对象，与函数无关</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// fn 其实引用的是 foo</span>\n    <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &lt;-- 调用位置！</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"oops, global\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// a 是全局对象的属性</span>\n<span class=\"token function\">doFoo</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">foo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"oops, global\"</span>\n</code></pre>\n"}]}]},{"t":"heading","d":3,"p":{"lines":[68,69]},"v":"显式绑定","c":[{"t":"ordered_list","d":4,"p":{"lines":[70,75],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[70,71],"index":1},"v":"1. 利用call，apply和bind强行指定this的绑定对象"},{"t":"list_item","d":5,"p":{"lines":[71,72],"index":2},"v":"2. 显式绑定的硬绑定特性解决了之前this恢复默认绑定问题"},{"t":"list_item","d":5,"p":{"lines":[72,73],"index":3},"v":"3. 部分内置函数提供参数，支持上下文context绑定"},{"t":"list_item","d":5,"p":{"lines":[73,74],"index":4},"v":"4. 显示绑定对象为null，或者undefined则执行默认绑定"}]},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">\"awesome\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 调用 foo(..) 时把 this 绑定到 obj</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 1 awesome 2 awesome 3 awesome</span>\n</code></pre>\n"},{"t":"heading","d":4,"p":{"lines":[87,88]},"v":"call，apply和bind原理","c":[{"t":"list_item","d":6,"p":{"lines":[90,91],"index":1},"v":"1. call传入两个参数(context, ...args)","c":[{"t":"list_item","d":8,"p":{"lines":[91,92],"index":1},"v":"1. context因为默认绑定存在，未设置则window"},{"t":"list_item","d":8,"p":{"lines":[92,93],"index":2},"v":"2. 否则将context.fn设置为this，并执行返回res（记得delete删除fn）"}]},{"t":"list_item","d":6,"p":{"lines":[93,94],"index":2},"v":"2. apply就是直接对call封装，将传入的第二个参数展开"},{"t":"list_item","d":6,"p":{"lines":[94,95],"index":3},"v":"3. bing利用闭包，返回一个处理函数Fn","c":[{"t":"list_item","d":8,"p":{"lines":[95,96],"index":1},"v":"1. 首先判断context，当this instanceof Fn时，则context为this，否则不变"},{"t":"list_item","d":8,"p":{"lines":[96,97],"index":2},"v":"2. 利用apply绑定context执行，（记得传入的参数合并bind和Fn的共同参数）"}]}]}]},{"t":"heading","d":3,"p":{"lines":[98,99]},"v":"new绑定","c":[{"t":"ordered_list","d":4,"p":{"lines":[100,105],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[100,101],"index":1},"v":"1. 首先创建了一个新的空对象"},{"t":"list_item","d":5,"p":{"lines":[101,102],"index":2},"v":"2. 设置原型，将对象的原型设置为函数的 prototype 对象"},{"t":"list_item","d":5,"p":{"lines":[102,103],"index":3},"v":"3. 让函数的 this 指向这个对象，执行构造函数的代码（为这个新对象添加属性）"},{"t":"list_item","d":5,"p":{"lines":[103,104],"index":4},"v":"4. 判断函数的返回值类型，如果是值类型，返回创建的对象。如果是引用类型，就返回这个引用类型的对象"}]},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">_new</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn<span class=\"token punctuation\">,</span> args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> fn <span class=\"token operator\">!==</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token known-class-name class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fn is not function'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    obj<span class=\"token punctuation\">.</span><span class=\"token property-access\">__proto__</span> <span class=\"token operator\">=</span> fn<span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span>\n    <span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> fn<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">typeof</span> res <span class=\"token operator\">==</span> <span class=\"token string\">'object'</span> <span class=\"token operator\">?</span> res <span class=\"token operator\">:</span> obj\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[117,118]},"v":"箭头函数","c":[{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> foo<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 箭头函数的this并没有变动</span>\nbar<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>obj2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2, 不是 3 ！</span>\n</code></pre>\n"},{"t":"heading","d":3,"p":{"lines":[134,135]},"v":"针对箭头函数的this有以下特点","c":[{"t":"list_item","d":5,"p":{"lines":[136,137],"index":1},"v":"1. 创建箭头函数时，创建它的上下文的this就是箭头函数的this"},{"t":"list_item","d":5,"p":{"lines":[137,138],"index":2},"v":"2. 箭头函数的this无法修改绑定（new也不可以）"}]}]},{"t":"heading","d":2,"p":{"lines":[139,140]},"v":"相关题目","c":[{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 隐式绑定，只看方法从哪获取的</span>\n<span class=\"token keyword\">var</span> length <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">var</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>foo<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\narr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 隐式绑定 this -> arr2 -> 4</span>\n<span class=\"token keyword\">var</span> fn <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 默认绑定 this -> window -> 1</span>\n</code></pre>\n"}]}]})</script>
</body>
</html>
