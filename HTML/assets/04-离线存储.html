<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"<a href=\"https://mp.weixin.qq.com/s/Q-Z8kYWSUJpkpAkTBv1Igw\">离线存储</a>","c":[{"t":"heading","d":2,"p":{"lines":[2,3]},"v":"离线存储优势","c":[{"t":"list_item","d":4,"p":{"lines":[4,5],"index":1},"v":"1. 离线浏览：用户可在应用离线时使用它们"},{"t":"list_item","d":4,"p":{"lines":[5,6],"index":2},"v":"2. 速度：已缓存资源加载得更快"},{"t":"list_item","d":4,"p":{"lines":[6,7],"index":3},"v":"3. 减少服务器负载：浏览器将只从服务器下载更新过或更改过的资源"}]},{"t":"heading","d":2,"p":{"lines":[8,9]},"v":"离线存储原理","c":[{"t":"list_item","d":4,"p":{"lines":[10,11],"index":1},"v":"1. 基于一个新建的 .appcache 文件的缓存机制"},{"t":"list_item","d":4,"p":{"lines":[11,12],"index":2},"v":"2. 通过文件上的解析清单离线存储资源，这些资源就会像cookie一样被缓存了下来"},{"t":"list_item","d":4,"p":{"lines":[12,13],"index":3},"v":"3. 网络离线时，则会将存储的数据展示出来"}]},{"t":"heading","d":2,"p":{"lines":[14,15]},"v":"离线存储加载流程","c":[{"t":"list_item","d":4,"p":{"lines":[16,17],"index":1},"v":"1. 如果在线并存在manifest属性：请求manifest文件，第一次访问下载资源并访问，比较新旧manifest文件决定是否更新资源"},{"t":"list_item","d":4,"p":{"lines":[17,18],"index":2},"v":"2. 离线：直接使用离线资源"}]},{"t":"heading","d":2,"p":{"lines":[19,20]},"v":"离线存储使用","c":[{"t":"heading","d":3,"p":{"lines":[21,22]},"v":"manifest属性设置","c":[{"t":"fence","d":4,"v":"<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">manifest</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>demo.appcache<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>demo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>img.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>500<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>900<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    其它内容...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[42,43]},"v":"manifest文件配置","c":[{"t":"fence","d":4,"v":"<pre class=\"language-appcache\"><code class=\"language-appcache\">CACHE MANIFEST\n#version 1.0\nCACHE：\n    img.jpg\nNETWORK:\n    *\nFALLBACK:\n    /demo/ /404.html\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[57,58]},"v":"编程访问操作","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> oAppCache <span class=\"token operator\">=</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">applicationCache</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> sCacheStatus <span class=\"token operator\">=</span> <span class=\"token string\">\"Not supported\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">switch</span> <span class=\"token punctuation\">(</span>oAppCache<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span> <span class=\"token comment\">// UNCACHED == 0 </span>\n        sCacheStatus <span class=\"token operator\">=</span> <span class=\"token string\">'（UNCACHED） : 无缓存， 即没有与页面相关的应用缓存'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span> <span class=\"token comment\">// IDLE == 1 </span>\n        sCacheStatus <span class=\"token operator\">=</span> <span class=\"token string\">'（IDLE） : 闲置，即应用缓存未得到更新'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span> <span class=\"token comment\">// CHECKING == 2 </span>\n        sCacheStatus <span class=\"token operator\">=</span> <span class=\"token string\">'（CHECKING） : 检查中，即正在下载描述文件并检查更新'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span> <span class=\"token comment\">// DOWNLOADING == 3 </span>\n        sCacheStatus <span class=\"token operator\">=</span> <span class=\"token string\">'（DOWNLOADING） : 下载中，即应用缓存正在下载描述文件'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span> <span class=\"token comment\">// UPDATEREADY == 4 </span>\n        sCacheStatus <span class=\"token operator\">=</span> <span class=\"token string\">'（UPDATEREADY） : 更新完成，所有资源都已下载完毕'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span> <span class=\"token comment\">// OBSOLETE == 5 </span>\n        sCacheStatus <span class=\"token operator\">=</span> <span class=\"token string\">'（IDLE） : 废弃，即应用缓存的描述文件已经不存在了，因此页面无法再访问应用缓存'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">default</span><span class=\"token operator\">:</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'UKNOWN CACHE STATUS'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[89,90]},"v":"离线存储更新缓存","c":[{"t":"ordered_list","d":3,"p":{"lines":[91,95],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[91,92],"index":1},"v":"1. 用户清空浏览器缓存"},{"t":"list_item","d":4,"p":{"lines":[92,93],"index":2},"v":"2. manifest 文件被修改"},{"t":"list_item","d":4,"p":{"lines":[93,94],"index":3},"v":"3. 由程序来更新应用缓存"}]},{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\">oAppCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'updateready'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            oAppCache<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">swapCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 更新本地缓存</span>\n            <span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//重新加载页面页面</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> fal\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[102,103]},"v":"区别于浏览器缓存","c":[{"t":"list_item","d":4,"p":{"lines":[104,105],"index":1},"v":"1. 离线缓存是针对整个应用，浏览器缓存是单个文件"},{"t":"list_item","d":4,"p":{"lines":[105,106],"index":2},"v":"2. 离线缓存断网了还是可以打开页面，浏览器缓存不行"},{"t":"list_item","d":4,"p":{"lines":[106,107],"index":3},"v":"3. 离线缓存可以主动通知浏览器更新资源"}]}]})</script>
</body>
</html>
