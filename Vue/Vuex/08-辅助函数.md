# 辅助函数

在helpers中导出了使用的辅助函数

## map的处理

在map的处理前，会将参数进行处理

```js
// namepace规范化
function normalizeNamespace(fn) {
    return (namespace, map) => {
        if (typeof namespace !== 'string') {
            map = namespace
            namespace = ''
        } else if (namespace.charAt(namespace.length - 1) !== '/') {
            namespace += '/'
        }
        return fn(namespace, map)
    }
}
// map规范化为数组
function normalizeMap(map) {
    if (!isValidMap(map)) {
        return []
    }
    return Array.isArray(map) ?
        map.map(key => ({
            key,
            val: key
        })) :
        Object.keys(map).map(key => ({
            key,
            val: map[key]
        }))
}
```

```js
export const mapState = normalizeNamespace((namespace, states) => {
    const res = {}
    normalizeMap(states).forEach(({
        key,
        val
    }) => {
        res[key] = function mappedState() {
            let state = this.$store.state
            let getters = this.$store.getters
            if (namespace) {
                const module = getModuleByNamespace(this.$store, 'mapState', namespace)
                if (!module) {
                    return
                }
                state = module.context.state
                getters = module.context.getters
            }
            return typeof val === 'function' ?
                val.call(this, state, getters) :
                state[val]
        }
        res[key].vuex = true
    })
    return res
})
```

其他的外壳都一样，只是最后的处理不同

```js
// mapMutations
res[key] = function mappedMutation(...args) {
    let commit = this.$store.commit
    if (namespace) {
        const module = getModuleByNamespace(this.$store, 'mapMutations', namespace)
        if (!module) {
            return
        }
        commit = module.context.commit
    }
    return typeof val === 'function' ?
        val.apply(this, [commit].concat(args)) :
        commit.apply(this.$store, [val].concat(args))
}

// mapGetters
val = namespace + val
res[key] = function mappedGetter() {
    if (namespace && !getModuleByNamespace(this.$store, 'mapGetters', namespace)) {
        return
    }
    return this.$store.getters[val]
}
res[key].vuex = true

//mapActions
res[key] = function mappedAction(...args) {
    let dispatch = this.$store.dispatch
    if (namespace) {
        const module = getModuleByNamespace(this.$store, 'mapActions', namespace)
        if (!module) {
            return
        }
        dispatch = module.context.dispatch
    }
    return typeof val === 'function' ?
        val.apply(this, [dispatch].concat(args)) :
        dispatch.apply(this.$store, [val].concat(args))
}
```

## createNamespacedHelpers

```js
export const createNamespacedHelpers = (namespace) => ({
    mapState: mapState.bind(null, namespace),
    mapGetters: mapGetters.bind(null, namespace),
    mapMutations: mapMutations.bind(null, namespace),
    mapActions: mapActions.bind(null, namespace)
})
```
