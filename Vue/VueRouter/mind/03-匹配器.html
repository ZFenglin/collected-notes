<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"匹配器","c":[{"t":"heading","d":2,"p":{"lines":[2,3]},"v":"createMatcher创建匹配器","c":[{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">matcher</span> <span class=\"token operator\">=</span> <span class=\"token function\">createMatcher</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span><span class=\"token property-access\">routes</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n</code></pre>\n"},{"t":"ordered_list","d":3,"p":{"lines":[8,15],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[8,9],"index":1},"v":"1. VueRouter中constructor传入对应的routes"},{"t":"list_item","d":4,"p":{"lines":[9,10],"index":2},"v":"2. 调用createMatcher创建matcher，获取VueRouter需要的相关方法","c":[{"t":"list_item","d":6,"p":{"lines":[10,11],"index":1},"v":"1. matcher.match"},{"t":"list_item","d":6,"p":{"lines":[11,12],"index":2},"v":"2. matcher.addRoute"},{"t":"list_item","d":6,"p":{"lines":[12,13],"index":3},"v":"3. matcher.getRoutes"},{"t":"list_item","d":6,"p":{"lines":[13,14],"index":4},"v":"4. matcher.addRoutes"}]}]},{"t":"heading","d":3,"p":{"lines":[15,16]},"v":"执行流程","c":[{"t":"ordered_list","d":4,"p":{"lines":[17,21],"start":1},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[17,18],"index":1},"v":"1. 获取路由相关映射对象"},{"t":"list_item","d":5,"p":{"lines":[18,19],"index":2},"v":"2. 创建处理映射方（导出的方法和内部方法）"},{"t":"list_item","d":5,"p":{"lines":[19,20],"index":3},"v":"3. 返回导出方法"}]},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// vue-router/src/create-matcher.js</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createMatcher</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">routes<span class=\"token punctuation\">,</span> router</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 获取路由相关映射对象</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n        pathList<span class=\"token punctuation\">,</span>\n        pathMap<span class=\"token punctuation\">,</span>\n        nameMap\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">createRouteMap</span><span class=\"token punctuation\">(</span>routes<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 导出的方法</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">addRoutes</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">routes</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">addRoute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">parentOrRoute<span class=\"token punctuation\">,</span> route</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">getRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">raw<span class=\"token punctuation\">,</span> currentRoute<span class=\"token punctuation\">,</span> redirectedFrom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 内部使用的方法</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">alias</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> matchAs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">_createRoute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> redirectedFrom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 返回对应方法</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        match<span class=\"token punctuation\">,</span>\n        addRoute<span class=\"token punctuation\">,</span>\n        getRoutes<span class=\"token punctuation\">,</span>\n        addRoutes\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[54,55]},"v":"createRouteMap创建路由Map","c":[{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    pathList<span class=\"token punctuation\">,</span>\n    pathMap<span class=\"token punctuation\">,</span>\n    nameMap\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">createRouteMap</span><span class=\"token punctuation\">(</span>routes<span class=\"token punctuation\">)</span>\n</code></pre>\n"},{"t":"ordered_list","d":3,"p":{"lines":[67,71],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[67,68],"index":1},"v":"1. 存储对象设置"},{"t":"list_item","d":4,"p":{"lines":[68,69],"index":2},"v":"2. 遍历路由创建record"},{"t":"list_item","d":4,"p":{"lines":[69,70],"index":3},"v":"3. 返回处理好的map"}]},{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// vue-router/src/create-route-map.js</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createRouteMap</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">route<span class=\"token punctuation\">,</span> oldPathList<span class=\"token punctuation\">,</span> oldPathMap<span class=\"token punctuation\">,</span> oldNameMap<span class=\"token punctuation\">,</span> parentRoute</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 存储对象设置</span>\n    <span class=\"token keyword\">const</span> pathList <span class=\"token operator\">=</span> oldPathList <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// 路由路径收集</span>\n    <span class=\"token keyword\">const</span> pathMap <span class=\"token operator\">=</span> oldPathMap <span class=\"token operator\">||</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// path和record映射收集（包括alias的）</span>\n    <span class=\"token keyword\">const</span> nameMap <span class=\"token operator\">=</span> oldNameMap <span class=\"token operator\">||</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// name和record映射收集</span>\n    <span class=\"token comment\">// 遍历路由创建record</span>\n    routes<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">route</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">addRouteRecord</span><span class=\"token punctuation\">(</span>pathList<span class=\"token punctuation\">,</span> pathMap<span class=\"token punctuation\">,</span> nameMap<span class=\"token punctuation\">,</span> route<span class=\"token punctuation\">,</span> parentRoute<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> l <span class=\"token operator\">=</span> pathList<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> l<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>pathList<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            pathList<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>pathList<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">splice</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            l<span class=\"token operator\">--</span>\n            i<span class=\"token operator\">--</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        pathList<span class=\"token punctuation\">,</span>\n        pathMap<span class=\"token punctuation\">,</span>\n        nameMap\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[97,98]},"v":"addRouteRecord","c":[{"t":"ordered_list","d":3,"p":{"lines":[99,102],"start":1},"v":"","c":[{"t":"list_item","d":4,"p":{"lines":[99,100],"index":1},"v":"1. createRouteMap则是创建对应存储的对象"},{"t":"list_item","d":4,"p":{"lines":[100,101],"index":2},"v":"2. 然后调用addRouteRecord赋值"}]},{"t":"heading","d":3,"p":{"lines":[102,103]},"v":"执行流程","c":[{"t":"ordered_list","d":4,"p":{"lines":[104,111],"start":3},"v":"","c":[{"t":"list_item","d":5,"p":{"lines":[104,105],"index":3},"v":"3. 路径处理"},{"t":"list_item","d":5,"p":{"lines":[105,106],"index":4},"v":"4. 将记录record和路径path关联起来（最终路径会匹配到这个记录，里面可以自定义属性）"},{"t":"list_item","d":5,"p":{"lines":[106,107],"index":5},"v":"5. 子路由处理，将父亲record设置到其record上"},{"t":"list_item","d":5,"p":{"lines":[107,108],"index":6},"v":"6. pathList收集路径path，pathMap收集当前生成的record"},{"t":"list_item","d":5,"p":{"lines":[108,109],"index":7},"v":"7. 别名路由添加处理"},{"t":"list_item","d":5,"p":{"lines":[109,110],"index":8},"v":"8. nameMap收集record"}]},{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">addRouteRecord</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">pathList<span class=\"token punctuation\">,</span> pathMap<span class=\"token punctuation\">,</span> nameMap<span class=\"token punctuation\">,</span> route<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">,</span> matchAs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 路径处理</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n        path<span class=\"token punctuation\">,</span>\n        name\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> route\n    <span class=\"token keyword\">const</span> pathToRegexpOptions <span class=\"token operator\">=</span> route<span class=\"token punctuation\">.</span><span class=\"token property-access\">pathToRegexpOptions</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> normalizedPath <span class=\"token operator\">=</span> <span class=\"token function\">normalizePath</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">,</span> pathToRegexpOptions<span class=\"token punctuation\">.</span><span class=\"token property-access\">strict</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 将记录record和路径path关联起来</span>\n    <span class=\"token keyword\">const</span> record <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> normalizedPath<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token literal-property property\">components</span><span class=\"token operator\">:</span> route<span class=\"token punctuation\">.</span><span class=\"token property-access\">components</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword module\">default</span><span class=\"token operator\">:</span> route<span class=\"token punctuation\">.</span><span class=\"token property-access\">component</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// ...</span>\n        parent<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> route<span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span> <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> route<span class=\"token punctuation\">.</span><span class=\"token property-access\">components</span> <span class=\"token operator\">?</span>\n            route<span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword module\">default</span><span class=\"token operator\">:</span> route<span class=\"token punctuation\">.</span><span class=\"token property-access\">props</span>\n            <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 子路由处理，将父亲设置到其record上</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        route<span class=\"token punctuation\">.</span><span class=\"token property-access\">children</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">child</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> childMatchAs <span class=\"token operator\">=</span> matchAs <span class=\"token operator\">?</span>\n                <span class=\"token function\">cleanPath</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>matchAs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>child<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\n                <span class=\"token keyword nil\">undefined</span>\n            <span class=\"token function\">addRouteRecord</span><span class=\"token punctuation\">(</span>pathList<span class=\"token punctuation\">,</span> pathMap<span class=\"token punctuation\">,</span> nameMap<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">,</span> record<span class=\"token punctuation\">,</span> childMatchAs<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// pathList收集路径path，pathMap收集当前生成的record</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pathMap<span class=\"token punctuation\">[</span>record<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        pathList<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span>\n        pathMap<span class=\"token punctuation\">[</span>record<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> record\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 别名alias路由添加处理</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span><span class=\"token property-access\">alias</span> <span class=\"token operator\">!==</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// nameMap收集record</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[160,161]},"v":"matcher导出的方法","c":[{"t":"heading","d":3,"p":{"lines":[162,163]},"v":"addRoutes","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">addRoutes</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">routes</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createRouteMap</span><span class=\"token punctuation\">(</span>routes<span class=\"token punctuation\">,</span> pathList<span class=\"token punctuation\">,</span> pathMap<span class=\"token punctuation\">,</span> nameMap<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[172,173]},"v":"addRoute","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">addRoute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">parentOrRoute<span class=\"token punctuation\">,</span> route</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> parent <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> parentOrRoute <span class=\"token operator\">!==</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> nameMap<span class=\"token punctuation\">[</span>parentOrRoute<span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token keyword nil\">undefined</span>\n    <span class=\"token function\">createRouteMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>route <span class=\"token operator\">||</span> parentOrRoute<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> pathList<span class=\"token punctuation\">,</span> pathMap<span class=\"token punctuation\">,</span> nameMap<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">alias</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">createRouteMap</span><span class=\"token punctuation\">(</span>\n            parent<span class=\"token punctuation\">.</span><span class=\"token property-access\">alias</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">alias</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> alias<span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>route<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            pathList<span class=\"token punctuation\">,</span>\n            pathMap<span class=\"token punctuation\">,</span>\n            nameMap<span class=\"token punctuation\">,</span>\n            parent\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[195,196]},"v":"getRoutes","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">getRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> pathList<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span> <span class=\"token arrow operator\">=></span> pathMap<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":3,"p":{"lines":[205,206]},"v":"match","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">raw<span class=\"token punctuation\">,</span> currentRoute<span class=\"token punctuation\">,</span> redirectedFrom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 标准化location，并获取name</span>\n    <span class=\"token keyword\">const</span> <span class=\"token dom variable\">location</span> <span class=\"token operator\">=</span> <span class=\"token function\">normalizeLocation</span><span class=\"token punctuation\">(</span>raw<span class=\"token punctuation\">,</span> currentRoute<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> router<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n        name\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token dom variable\">location</span>\n    <span class=\"token comment\">// 调用_createRoute获取route</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 通过name</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 通过path</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 默认创建</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">_createRoute</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[227,228]},"v":"matcher内部的方法","c":[{"t":"fence","d":3,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 处理record，获取对应值，最后调用_createRoute然后到createRoute</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 处理别名，获取对应的值，最后调用_createRoute然后到createRoute</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">alias</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> matchAs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 按照参数，最后处理调用createRoute创建route</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">_createRoute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> redirectedFrom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>record <span class=\"token operator\">&amp;&amp;</span> record<span class=\"token punctuation\">.</span><span class=\"token property-access\">redirect</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">,</span> redirectedFrom <span class=\"token operator\">||</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>record <span class=\"token operator\">&amp;&amp;</span> record<span class=\"token punctuation\">.</span><span class=\"token property-access\">matchAs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">alias</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> record<span class=\"token punctuation\">.</span><span class=\"token property-access\">matchAs</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">createRoute</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> redirectedFrom<span class=\"token punctuation\">,</span> router<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"t":"heading","d":3,"p":{"lines":[253,254]},"v":"createRoute","c":[{"t":"fence","d":4,"v":"<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createRoute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record<span class=\"token punctuation\">,</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> redirectedFrom<span class=\"token punctuation\">,</span> router</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> stringifyQuery <span class=\"token operator\">=</span> router <span class=\"token operator\">&amp;&amp;</span> router<span class=\"token punctuation\">.</span><span class=\"token property-access\">options</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">stringifyQuery</span>\n    <span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">query</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        query <span class=\"token operator\">=</span> <span class=\"token function\">clone</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 获取route对象</span>\n    <span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>record <span class=\"token operator\">&amp;&amp;</span> record<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">meta</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>record <span class=\"token operator\">&amp;&amp;</span> record<span class=\"token punctuation\">.</span><span class=\"token property-access\">meta</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span> <span class=\"token operator\">||</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">hash</span> <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n        query<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> <span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">params</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">fullPath</span><span class=\"token operator\">:</span> <span class=\"token function\">getFullPath</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> stringifyQuery<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">matched</span><span class=\"token operator\">:</span> record <span class=\"token operator\">?</span> <span class=\"token function\">formatMatch</span><span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>redirectedFrom<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        route<span class=\"token punctuation\">.</span><span class=\"token property-access\">redirectedFrom</span> <span class=\"token operator\">=</span> <span class=\"token function\">getFullPath</span><span class=\"token punctuation\">(</span>redirectedFrom<span class=\"token punctuation\">,</span> stringifyQuery<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 冻结对象并返回</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">freeze</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]}]})</script>
</body>
</html>
